version: "3.8"
services:
  server:
    container_name: tatadata-server
    restart: always
    ports:
    - target: 8081
      published: 8081
    build: 
      dockerfile: server.dockerfile
    networks:
      - tatadata-net
    depends_on:
      - postgres
    environment:
      - BROKER_ADDRESS=${BROKER_ADDRESS}
      - POSTGRES_ADDRESS=${POSTGRES_ADDRESS}
  processor:
    container_name: tatadata-processor
    restart: always
    build: 
      dockerfile: processor.dockerfile
    networks:
      - tatadata-net
    depends_on:
      - mosquitto
      - postgres
    environment:
      - BROKER_ADDRESS=${BROKER_ADDRESS}
      - POSTGRES_ADDRESS=${POSTGRES_ADDRESS}
